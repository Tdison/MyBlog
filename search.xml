<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>DNS服务器配置</title>
      <link href="/2022/05/10/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/2022/05/10/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="操作环境"><a href="#操作环境" class="headerlink" title="操作环境"></a>操作环境</h3><ol><li>3台CentOS7主机<ul><li>10.10.0.51   主DNS服务器</li><li>10.10.0.52   从DNS服务器</li><li>10.10.0.53   WEB服务器</li></ul></li><li>关闭SElinux </li><li>关闭防火墙 </li><li>时间同步</li></ol><h3 id="安装band软件"><a href="#安装band软件" class="headerlink" title="安装band软件"></a>安装band软件</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum  -y install bind  bind-utils</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="主DNS服务器配置"><a href="#主DNS服务器配置" class="headerlink" title="主DNS服务器配置"></a>主DNS服务器配置</h3><p><strong>配置主配置文件</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>配置文件其中两行需要注释掉</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">..</span>.options <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;                                                                                                            </span>//  listen-on port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; 127.0.0.1; &amp;#125;;// 此行前面加注释</span>    listen-on-v6 port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; ::1; &amp;#125;;</span>    directory   <span class="token string">"/var/named"</span><span class="token punctuation">;</span>    dump-file   <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>    statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>    memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>    recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span>    secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span>//  allow-query     <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; localhost; &amp;#125;;// 此行前面加注释</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改配置文件<code>/etc/named.rfc1912.zones</code></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span><span class="token comment" spellcheck="true">#文本末尾加上下面内容</span>zone <span class="token string">"tdison.local"</span> IN <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; </span>    <span class="token function">type</span> master<span class="token punctuation">;</span>    <span class="token function">file</span> <span class="token string">"tdison.local.zone"</span><span class="token punctuation">;</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="修改DNS区域数据库文件"><a href="#修改DNS区域数据库文件" class="headerlink" title="修改DNS区域数据库文件"></a>修改DNS区域数据库文件</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp -p /var/named/named.localhost /var/named/tdison.local.zone</span><span class="token comment" spellcheck="true">#需要加上-p选项保留所有者和所有组权限，如下所示。若没有添加-p选项，需要手动修改权限。</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll /var/named/tdison.local.zone</span>-rw-r----- 1 root named 152 Jun 21  2007 /var/named/tdison.local.zone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/tdison.local.zone</span><span class="token variable">$TTL</span> 1D@   IN SOA  master admin.tdison.local. <span class="token punctuation">(</span>            2022050810  <span class="token punctuation">;</span> serial//每次修改后需要更新此序号，建议使用日期+小时方式                    1D  <span class="token punctuation">;</span> refresh//设置服务器同步拉取时间                    1H  <span class="token punctuation">;</span> retry//设置拉取错误时的重试时间                    1W  <span class="token punctuation">;</span> expire//设置从dns服务器的信息过期时间                    3H <span class="token punctuation">)</span>    <span class="token punctuation">;</span> minimum//设置错误查询记录缓存的保留时间            NS   mastermaster      A    10.10.0.51//此行作用将master.tdison.local解析成10.10.0.51www         A    10.10.0.53<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此条配置文件可以简写成</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token variable">$TTL</span> 1D@   IN SOA  master admin.tdison.local. <span class="token punctuation">(</span>2022050810 1D 1H 1W 3H <span class="token punctuation">)</span>                        NS   mastermasterA    10.10.0.51wwwA    10.10.0.53<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>区域解析库的记录类型：A, AAAA, PTR, SOA, NS, CNAME, MX</p><ul><li>SOA：Start Of Authority，起始授权记录；一个区域解析库有且仅能有一个SOA记录，<strong>必须位于解析库的第一条记录</strong></li><li>A：internet Address，作用：FQDN解析成IPv4地址 </li><li>AAAA：作用：FQDN解析成IPv6地址</li><li>PTR：PoinTeR，反向解析，IP –&gt; FQDN</li><li>NS：Name Server，专用于标明当前区域的DNS服务器 </li><li>CNAME ： Canonical Name，别名记录</li><li>MX：Mail eXchanger，邮件交换器</li><li>TXT：对域名进行标识和说明的一种方式，一般做验证记录时会使用此项，如：SPF（反垃圾邮件）记录，https验证等</li></ul><h3 id="检查配置文件和数据库文件格式，并启动服务"><a href="#检查配置文件和数据库文件格式，并启动服务" class="headerlink" title="检查配置文件和数据库文件格式，并启动服务"></a>检查配置文件和数据库文件格式，并启动服务</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkconf</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkzone tdison.local /var/named/tdison.local.zone</span>zone tdison.local/IN: loaded serial 2022050810OK<span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start named//第一次启动服务</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload//不是第一次启动服务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="启用DNS客户端缓存"><a href="#启用DNS客户端缓存" class="headerlink" title="启用DNS客户端缓存"></a>启用DNS客户端缓存</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum -y install nscd</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl enable --now nscd</span><span class="token comment" spellcheck="true">#查看缓存统计信息</span><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nscd -g</span><span class="token comment" spellcheck="true">#清除DNS客户端缓存</span><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nscd -i hosts</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="实现从服务器"><a href="#实现从服务器" class="headerlink" title="实现从服务器"></a>实现从服务器</h3><p><strong>主DNS服务端配置</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span><span class="token punctuation">..</span>.options <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>//  listen-on port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; 127.0.0.1; &amp;#125;;</span>    listen-on-v6 port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; ::1; &amp;#125;;</span>    directory   <span class="token string">"/var/named"</span><span class="token punctuation">;</span>    dump-file   <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>    statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>    memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>    recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span>    secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span>//  allow-query     <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; localhost; &amp;#125;;</span>    allow-transfer <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; 10.10.0.52;&amp;#125;;          //添加此行，仅允许该IP抓取dns数据库，IP修改成从dns服务器地址</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/tdison.local.zone</span><span class="token variable">$TTL</span> 1D@   IN SOA  master admin.tdison.local. <span class="token punctuation">(</span>            2022050810  <span class="token punctuation">;</span> serial                    1D  <span class="token punctuation">;</span> refresh                    1H  <span class="token punctuation">;</span> retry                    1W  <span class="token punctuation">;</span> expire                    3H <span class="token punctuation">)</span>    <span class="token punctuation">;</span> minimum        NS  master        NS  slave//添加此行master  A   10.10.0.51slave   A   10.10.0.52//添加此行www     A   10.10.0.53<span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start named//第一次启动服务</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload//不是第一次启动服务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>从DNS服务器配置</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum  -y install bind  bind-utils</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span><span class="token punctuation">..</span>.options <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>//  listen-on port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; 127.0.0.1; &amp;#125;;</span>    listen-on-v6 port 53 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; ::1; &amp;#125;;</span>    directory   <span class="token string">"/var/named"</span><span class="token punctuation">;</span>    dump-file   <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>    statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>    memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>    recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span>    secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span>//  allow-query     <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; localhost; &amp;#125;;</span>    allow-transfer <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; none;&amp;#125;;  </span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span><span class="token comment" spellcheck="true">#文本末尾加上下面内容</span>zone <span class="token string">"tdison.local"</span> IN <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token function">type</span> slave<span class="token punctuation">;</span>    masters <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; 10.10.0.51;&amp;#125;;//IP改成主DNS服务器地址</span>    <span class="token function">file</span> <span class="token string">"slaves/tdison.local.zone"</span><span class="token punctuation">;</span>                                                                                 <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;; </span><span class="token comment" spellcheck="true">#检查配置文件格式是否错误</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkconf</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start named          #第一次启动服务 </span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload                    #不是第一次启动服务</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls  /var/named/slaves/tdison.local.zone #查看区域数据库文件是否生成</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WEB服务器上实现WEB服务"><a href="#WEB服务器上实现WEB服务" class="headerlink" title="WEB服务器上实现WEB服务"></a>WEB服务器上实现WEB服务</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#安装http服务</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum install -y httpd                        </span><span class="token comment" spellcheck="true">#配置主页面</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo hello  > /var/www/html/index.html </span><span class="token comment" spellcheck="true">#启动服务</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start httpd                    </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="在客户端实现测试"><a href="#在客户端实现测试" class="headerlink" title="在客户端实现测试"></a>在客户端实现测试</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/sysconfig/network-scripts/ifcfg-eth0 </span><span class="token punctuation">..</span>.DNS1<span class="token operator">=</span>10.10.0.51DNS2<span class="token operator">=</span>10.10.0.52<span class="token punctuation">..</span>.<span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli con reload </span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli con up eth0</span><span class="token comment" spellcheck="true">#测试DNS服务器</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig www.tdison.local @10.10.0.51</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig www.tdison.local @10.10.0.52</span><span class="token comment" spellcheck="true">#测试网页</span><span class="token punctuation">[</span>root@CentOS7 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># curl www.tdison.local</span>hello<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DNS </tag>
            
            <tag> CENTOS </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
