<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CentOS配置网卡文件</title>
      <link href="/2022/05/10/CentOS%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1%E6%96%87%E4%BB%B6/"/>
      <url>/2022/05/10/CentOS%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Linux网卡常用配置"><a href="#Linux网卡常用配置" class="headerlink" title="Linux网卡常用配置"></a>Linux网卡常用配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0       //eth0修改成设备名</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet               //接口类型</span><br><span class="line">DEVICE=eth1                 //设备名</span><br><span class="line">NAME=eth1                   //此配置文件应用到的设备</span><br><span class="line">BOOTPROTO=static            //激活此设备时使用的地址配置协议，常用的dhcp, static, none, bootp</span><br><span class="line">IPADDR=10.10.0.51           //指明IP地址（dhcp可忽略）</span><br><span class="line">PREFIX=24                   //网络ID的位数, 如:24（dhcp可忽略）</span><br><span class="line">DNS1=10.0.0.1               //DNS服务器地址（dhcp可忽略）</span><br><span class="line">DNS2=223.5.5.5              //DNS服务器地址（dhcp可忽略）</span><br><span class="line">GATEWAY=10.10.0.1           //默认网关（dhcp可忽略）</span><br><span class="line">ONBOOT=yes                  //在系统引导时是否激活此设备</span><br><span class="line">UUID=cd3d4bc1-3499-397a-98f6-188560209932        //设备的惟一标识</span><br></pre></td></tr></table></figure><h3 id="UUID查询方法"><a href="#UUID查询方法" class="headerlink" title="UUID查询方法"></a>UUID查询方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]# nmcli connection </span><br><span class="line">NAME  UUID                                  TYPE      DEVICE </span><br><span class="line">eth0  48c87a52-20b1-308e-addd-386999dd94ed  ethernet  eth0   </span><br><span class="line">eth1  a8e6aa0e-0098-3ee8-82d1-99f12efb6aff  ethernet  eth1</span><br></pre></td></tr></table></figure><h3 id="使修改后的配置生效"><a href="#使修改后的配置生效" class="headerlink" title="使修改后的配置生效"></a>使修改后的配置生效</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]# nmcli connection reload</span><br><span class="line">[root@CentOS7 ~]# nmcli connection up eth0       //eth0修改成设备名</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CENTOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNS服务器配置</title>
      <link href="/2022/05/10/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/2022/05/10/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="操作环境"><a href="#操作环境" class="headerlink" title="操作环境"></a>操作环境</h3><ol><li>3台CentOS7主机<ul><li>10.10.0.51   主DNS服务器</li><li>10.10.0.52   从DNS服务器</li><li>10.10.0.53   WEB服务器</li></ul></li><li>关闭SElinux </li><li>关闭防火墙 </li><li>时间同步</li></ol><h3 id="安装band软件"><a href="#安装band软件" class="headerlink" title="安装band软件"></a>安装band软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># yum  -y install bind  bind-utils</span></span><br></pre></td></tr></table></figure><h3 id="主DNS服务器配置"><a href="#主DNS服务器配置" class="headerlink" title="主DNS服务器配置"></a>主DNS服务器配置</h3><p><strong>配置主配置文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># vim /etc/named.conf</span></span><br></pre></td></tr></table></figure><p>配置文件其中两行需要注释掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">options &#123;                                                                                                            </span><br><span class="line">//  listen-on port 53 &#123; 127.0.0.1; &#125;;       // 此行前面加注释</span><br><span class="line">    listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">    directory   <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">    dump-file   <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-file <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-file <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">    recursing-file  <span class="string">&quot;/var/named/data/named.recursing&quot;</span>;</span><br><span class="line">    secroots-file   <span class="string">&quot;/var/named/data/named.secroots&quot;</span>;</span><br><span class="line">//  allow-query     &#123; localhost; &#125;;         // 此行前面加注释</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>修改配置文件<code>/etc/named.rfc1912.zones</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># vim /etc/named.rfc1912.zones</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#文本末尾加上下面内容</span></span><br><span class="line">zone <span class="string">&quot;tdison.local&quot;</span> IN &#123; </span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;tdison.local.zone&quot;</span>; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="修改DNS区域数据库文件"><a href="#修改DNS区域数据库文件" class="headerlink" title="修改DNS区域数据库文件"></a>修改DNS区域数据库文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># cp -p /var/named/named.localhost /var/named/tdison.local.zone</span></span><br><span class="line"><span class="comment">#需要加上-p选项保留所有者和所有组权限，如下所示。若没有添加-p选项，需要手动修改权限。</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># ll /var/named/tdison.local.zone</span></span><br><span class="line">-rw-r----- 1 root named 152 Jun 21  2007 /var/named/tdison.local.zone</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># vim /var/named/tdison.local.zone</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA  master admin.tdison.local. (</span><br><span class="line">            2022050810  ; serial        //每次修改后需要更新此序号，建议使用日期+小时方式</span><br><span class="line">                    1D  ; refresh       //设置服务器同步拉取时间</span><br><span class="line">                    1H  ; retry         //设置拉取错误时的重试时间</span><br><span class="line">                    1W  ; expire        //设置从dns服务器的信息过期时间</span><br><span class="line">                    3H )    ; minimum   //设置错误查询记录缓存的保留时间</span><br><span class="line">            NS   master</span><br><span class="line">master      A    10.10.0.51      //此行作用将master.tdison.local解析成10.10.0.51</span><br><span class="line">www         A    10.10.0.53</span><br></pre></td></tr></table></figure><p>此条配置文件可以简写成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA  master admin.tdison.local. (2022050810 1D 1H 1W 3H )</span><br><span class="line">NS   master</span><br><span class="line">master      A    10.10.0.51</span><br><span class="line">www         A    10.10.0.53</span><br></pre></td></tr></table></figure><p>区域解析库的记录类型：A, AAAA, PTR, SOA, NS, CNAME, MX</p><ul><li>SOA：Start Of Authority，起始授权记录；一个区域解析库有且仅能有一个SOA记录，<strong>必须位于解析库的第一条记录</strong></li><li>A：internet Address，作用：FQDN解析成IPv4地址 </li><li>AAAA：作用：FQDN解析成IPv6地址</li><li>PTR：PoinTeR，反向解析，IP –&gt; FQDN</li><li>NS：Name Server，专用于标明当前区域的DNS服务器 </li><li>CNAME ： Canonical Name，别名记录</li><li>MX：Mail eXchanger，邮件交换器</li><li>TXT：对域名进行标识和说明的一种方式，一般做验证记录时会使用此项，如：SPF（反垃圾邮件）记录，https验证等</li></ul><h3 id="检查配置文件和数据库文件格式，并启动服务"><a href="#检查配置文件和数据库文件格式，并启动服务" class="headerlink" title="检查配置文件和数据库文件格式，并启动服务"></a>检查配置文件和数据库文件格式，并启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># named-checkconf</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># named-checkzone tdison.local /var/named/tdison.local.zone</span></span><br><span class="line">zone tdison.local/IN: loaded serial 2022050810</span><br><span class="line">OK</span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl start named     //第一次启动服务</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># rndc reload               //不是第一次启动服务</span></span><br></pre></td></tr></table></figure><h3 id="启用DNS客户端缓存"><a href="#启用DNS客户端缓存" class="headerlink" title="启用DNS客户端缓存"></a>启用DNS客户端缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># yum -y install nscd</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl enable --now nscd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看缓存统计信息</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># nscd -g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#清除DNS客户端缓存</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># nscd -i hosts</span></span><br></pre></td></tr></table></figure><h3 id="实现从服务器"><a href="#实现从服务器" class="headerlink" title="实现从服务器"></a>实现从服务器</h3><p><strong>主DNS服务端配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># vim /etc/named.conf</span></span><br><span class="line">...</span><br><span class="line">options &#123;</span><br><span class="line">//  listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">    listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">    directory   <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">    dump-file   <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-file <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-file <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">    recursing-file  <span class="string">&quot;/var/named/data/named.recursing&quot;</span>;</span><br><span class="line">    secroots-file   <span class="string">&quot;/var/named/data/named.secroots&quot;</span>;</span><br><span class="line">//  allow-query     &#123; localhost; &#125;;</span><br><span class="line">    allow-transfer &#123; 10.10.0.52;&#125;;          //添加此行，仅允许该IP抓取dns数据库，IP修改成从dns服务器地址</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># vim /var/named/tdison.local.zone</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@   IN SOA  master admin.tdison.local. (</span><br><span class="line">            2022050810  ; serial</span><br><span class="line">                    1D  ; refresh</span><br><span class="line">                    1H  ; retry</span><br><span class="line">                    1W  ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">        NS  master</span><br><span class="line">        NS  slave//添加此行</span><br><span class="line">master  A   10.10.0.51</span><br><span class="line">slave   A   10.10.0.52//添加此行</span><br><span class="line">www     A   10.10.0.53</span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl start named     //第一次启动服务</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># rndc reload               //不是第一次启动服务</span></span><br></pre></td></tr></table></figure><p><strong>从DNS服务器配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># yum  -y install bind  bind-utils</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># vim /etc/named.conf</span></span><br><span class="line">...</span><br><span class="line">options &#123;</span><br><span class="line">//  listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">    listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">    directory   <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">    dump-file   <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-file <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-file <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">    recursing-file  <span class="string">&quot;/var/named/data/named.recursing&quot;</span>;</span><br><span class="line">    secroots-file   <span class="string">&quot;/var/named/data/named.secroots&quot;</span>;</span><br><span class="line">//  allow-query     &#123; localhost; &#125;;</span><br><span class="line">    allow-transfer &#123; none;&#125;;  </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># vim /etc/named.rfc1912.zones</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#文本末尾加上下面内容</span></span><br><span class="line">zone <span class="string">&quot;tdison.local&quot;</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> slave;</span><br><span class="line">    masters &#123; 10.10.0.51;&#125;;//IP改成主DNS服务器地址</span><br><span class="line">    file <span class="string">&quot;slaves/tdison.local.zone&quot;</span>;                                                                                 </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">#检查配置文件格式是否错误</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># named-checkconf</span></span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl start named          #第一次启动服务 </span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># rndc reload                    #不是第一次启动服务</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># ls  /var/named/slaves/tdison.local.zone #查看区域数据库文件是否生成</span></span><br></pre></td></tr></table></figure><h3 id="WEB服务器上实现WEB服务"><a href="#WEB服务器上实现WEB服务" class="headerlink" title="WEB服务器上实现WEB服务"></a>WEB服务器上实现WEB服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装http服务</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># yum install -y httpd                        </span></span><br><span class="line"><span class="comment">#配置主页面</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># echo hello  &gt; /var/www/html/index.html </span></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl start httpd                    </span></span><br></pre></td></tr></table></figure><h3 id="在客户端实现测试"><a href="#在客户端实现测试" class="headerlink" title="在客户端实现测试"></a>在客户端实现测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-eth0 </span></span><br><span class="line">...</span><br><span class="line">DNS1=10.10.0.51</span><br><span class="line">DNS2=10.10.0.52</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># nmcli con reload </span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># nmcli con up eth0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试DNS服务器</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># dig www.tdison.local @10.10.0.51</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># dig www.tdison.local @10.10.0.52</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试网页</span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># curl www.tdison.local</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CENTOS </tag>
            
            <tag> DNS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>建立CentOS局域网源并与清华源同步</title>
      <link href="/2022/05/04/%E5%BB%BA%E7%AB%8BCentOS%E5%B1%80%E5%9F%9F%E7%BD%91%E6%BA%90%E5%B9%B6%E4%B8%8E%E6%B8%85%E5%8D%8E%E6%BA%90%E5%90%8C%E6%AD%A5/"/>
      <url>/2022/05/04/%E5%BB%BA%E7%AB%8BCentOS%E5%B1%80%E5%9F%9F%E7%BD%91%E6%BA%90%E5%B9%B6%E4%B8%8E%E6%B8%85%E5%8D%8E%E6%BA%90%E5%90%8C%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="1-禁止SELINUX"><a href="#1-禁止SELINUX" class="headerlink" title="1.禁止SELINUX"></a>1.禁止SELINUX</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo sed -i.bak &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config</span></span><br><span class="line"><span class="comment"># setenforce 0</span></span><br></pre></td></tr></table></figure><h3 id="2-修改防火墙策略"><a href="#2-修改防火墙策略" class="headerlink" title="2.修改防火墙策略"></a>2.修改防火墙策略</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --zone=public --add-port=80/tcp --permanent //--permanent 永久生效，没有此参数重启后失效，默认为80端口。</span></span><br><span class="line"><span class="comment"># systemctl restart firewalld</span></span><br></pre></td></tr></table></figure><h3 id="3-安装httpd服务"><a href="#3-安装httpd服务" class="headerlink" title="3. 安装httpd服务"></a>3. 安装httpd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y httpd</span></span><br></pre></td></tr></table></figure><h3 id="4-创建目录"><a href="#4-创建目录" class="headerlink" title="4. 创建目录"></a>4. 创建目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir -p /var/www/html/centos/&#123;6,7&#125;/os/x86_64/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/centos/&#123;6,7&#125;/updates/x86_64/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/centos/&#123;6,7&#125;/extras/x86_64/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/centos-vault/8.5.2111/BaseOS/x86_64/os/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/centos-vault/8.5.2111/extras/x86_64/os/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/centos-vault/8.5.2111/AppStream/x86_64/os/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/epel/&#123;6,7&#125;/x86_64</span></span><br><span class="line"><span class="comment"># mkdir -p /var/www/html/epel/8/Everything/x86_64/</span></span><br></pre></td></tr></table></figure><h3 id="5-同步镜像"><a href="#5-同步镜像" class="headerlink" title="5.同步镜像"></a>5.同步镜像</h3><p><strong>新建文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/local/local_mirror/exclude.list</span><br><span class="line"></span><br><span class="line">#填入以下内容</span><br><span class="line"></span><br><span class="line">SRPMS</span><br><span class="line">aarch64</span><br><span class="line">ppc64</span><br><span class="line">ppc64le</span><br><span class="line">debug</span><br><span class="line">repodata</span><br><span class="line">EFI</span><br><span class="line">LiveOS</span><br><span class="line">images</span><br><span class="line">isolinux</span><br><span class="line">CentOS_BuildTag</span><br><span class="line">EULA</span><br><span class="line">GPL</span><br><span class="line">drpms</span><br></pre></td></tr></table></figure><p><strong>新建运行脚本</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/local/sbin/sync.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">#</span><br><span class="line"># 此脚本用于同步&quot;http://mirrors.tuna.tsinghua.edu.cn&quot;的镜像到本地</span><br><span class="line"># 如果还需要其它系统那么直接往后面加上去</span><br><span class="line">#</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos/RPM-GPG-KEY-* /var/www/html/centos/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/RPM-GPG-KEY-* /var/www/html/centos-vault/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/epel/RPM-GPG-KEY-* /var/www/html/epel/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/epel/7/x86_64/ /var/www/html/epel/7/x86_64/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos/7/extras/x86_64/ /var/www/html/centos/7/extras/x86_64 &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos/7/updates/x86_64/ /var/www/html/centos/7/updates/x86_64 &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/ /var/www/html/centos/7/os/x86_64 &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/BaseOS/x86_64/os/ /var/www/html/centos-vault/8.5.2111/BaseOS/x86_64/os/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/extras/x86_64/os/ /var/www/html/centos-vault/8.5.2111/extras/x86_64/os/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/8.5.2111/AppStream/x86_64/os/ /var/www/html/centos-vault/8.5.2111/AppStream/x86_64/os/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/epel/8/Everything/x86_64/ /var/www/html/epel/8/Everything/x86_64/ &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/6.10/extras/x86_64/ /var/www/html/centos/6/extras/x86_64 &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/6.10/updates/x86_64/ /var/www/html/centos/6/updates/x86_64 &amp;&amp; \</span><br><span class="line">rsync -avrt --exclude-from=/usr/local/local_mirror/exclude.list rsync://mirrors.tuna.tsinghua.edu.cn/centos-vault/6.10/os/x86_64/ /var/www/html/centos/6/os/x86_64</span><br></pre></td></tr></table></figure><h3 id="6-加入计划任务"><a href="#6-加入计划任务" class="headerlink" title="6. 加入计划任务"></a>6. 加入计划任务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 * * * sh /usr/local/sbin/sync.sh &amp;&gt; /tmp/yum.log</span><br></pre></td></tr></table></figure><h3 id="7-客户端repo配置"><a href="#7-客户端repo配置" class="headerlink" title="7.客户端repo配置"></a>7.客户端repo配置</h3><p><strong>Centos-vault-6.10.repo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># CentOS-Base.repo</span><br><span class="line">#</span><br><span class="line"># The mirror system uses the connecting IP address of the client and the</span><br><span class="line"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="line"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="line"># unless you are manually picking other mirrors.</span><br><span class="line">#</span><br><span class="line"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="line"># remarked out baseurl= line instead.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">[base]</span><br><span class="line">name=CentOS-vault-6.10 - Base - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/6.10/os/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos-vault/RPM-GPG-KEY-CentOS-6</span><br><span class="line"> </span><br><span class="line">#released updates </span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-vault-6.10 - Updates - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/6.10/updates/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos-vault/RPM-GPG-KEY-CentOS-6</span><br><span class="line"> </span><br><span class="line">#additional packages that may be useful</span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-vault-6.10 - Extras - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/6.10/extras/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos-vault/RPM-GPG-KEY-CentOS-6</span><br></pre></td></tr></table></figure><p><strong>Centos-7.repo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># CentOS-Base.repo</span><br><span class="line">#</span><br><span class="line"># The mirror system uses the connecting IP address of the client and the</span><br><span class="line"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="line"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="line"># unless you are manually picking other mirrors.</span><br><span class="line">#</span><br><span class="line"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="line"># remarked out baseurl= line instead.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos/$releasever/os/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#released updates </span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-$releasever - Updates - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos/$releasever/updates/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"> </span><br><span class="line">#additional packages that may be useful</span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-$releasever - Extras - 10.10.0.2</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://10.10.0.2/centos/$releasever/extras/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Centos-vault-8.5.2111.repo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># CentOS-Base.repo</span><br><span class="line">#</span><br><span class="line"># The mirror system uses the connecting IP address of the client and the</span><br><span class="line"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="line"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="line"># unless you are manually picking other mirrors.</span><br><span class="line">#</span><br><span class="line"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="line"># remarked out baseurl= line instead.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line">[base]</span><br><span class="line">name=CentOS-8.5.2111 - Base - 10.10.0.2</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/8.5.2111/BaseOS/$basearch/os/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-Official</span><br><span class="line"> </span><br><span class="line">#additional packages that may be useful</span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-8.5.2111 - Extras - 10.10.0.2</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/8.5.2111/extras/$basearch/os/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-Official</span><br><span class="line"></span><br><span class="line">[AppStream]</span><br><span class="line">name=CentOS-8.5.2111 - AppStream - 10.10.0.2</span><br><span class="line">baseurl=http://10.10.0.2/centos-vault/8.5.2111/AppStream/$basearch/os/</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=http://10.10.0.2/centos/RPM-GPG-KEY-CentOS-Official</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>epel-7.repo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[epel]</span><br><span class="line">name=Extra Packages for Enterprise Linux 7 - $basearch</span><br><span class="line">baseurl=http://10.10.0.2/epel/7/$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=http://10.10.0.2/epel/RPM-GPG-KEY-EPEL-7</span><br></pre></td></tr></table></figure><p><strong>epel-8.repo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[epel]</span><br><span class="line">name=Extra Packages for Enterprise Linux $releasever - $basearch</span><br><span class="line"># It is much more secure to use the metalink, but if you wish to use a local mirror</span><br><span class="line"># place it&#x27;s address here.</span><br><span class="line">baseurl=https://10.10.0.2/epel/$releasever/Everything/$basearch</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">countme=1</span><br><span class="line">gpgkey=http://10.10.0.2/epel/RPM-GPG-KEY-EPEL-8</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CENTOS </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
